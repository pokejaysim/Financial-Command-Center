<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Financial Command Center</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --background: #ffffff;
            --card-background: #ffffff;
            --border-color: #e5e7eb;
            --shadow: rgba(0, 0, 0, 0.05);
            --shadow-md: rgba(0, 0, 0, 0.1);
            --font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            --radius: 12px;
            --spacing: 1.5rem;
        }

        [data-theme="dark"] {
            --primary-color: #3b82f6;
            --success-color: #22c55e;
            --warning-color: #fbbf24;
            --danger-color: #f87171;
            --text-primary: #f3f4f6;
            --text-secondary: #9ca3af;
            --background: #111827;
            --card-background: #1f2937;
            --border-color: #374151;
            --shadow: rgba(0, 0, 0, 0.2);
            --shadow-md: rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing);
        }

        /* Header Styles */
        header {
            background-color: var(--card-background);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 4px var(--shadow);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .month-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background-color: var(--background);
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            border: 1px solid var(--border-color);
        }

        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius);
            transition: background-color 0.3s;
        }

        .theme-toggle:hover {
            background-color: var(--border-color);
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            margin: var(--spacing) 0;
            border-bottom: 2px solid var(--border-color);
            overflow-x: auto;
            scrollbar-width: thin;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
        }

        .nav-tab:hover {
            color: var(--text-primary);
        }

        .nav-tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        /* Main Content */
        .main-content {
            margin: var(--spacing) 0;
            min-height: calc(100vh - 200px);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Card Styles */
        .card {
            background-color: var(--card-background);
            border-radius: var(--radius);
            padding: var(--spacing);
            box-shadow: 0 1px 3px var(--shadow);
            transition: all 0.3s;
            border: 1px solid var(--border-color);
        }

        .card:hover {
            box-shadow: 0 4px 6px var(--shadow-md);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: var(--spacing);
            margin-bottom: var(--spacing);
        }

        .metric-card {
            background-color: var(--card-background);
            border-radius: var(--radius);
            padding: var(--spacing);
            box-shadow: 0 1px 3px var(--shadow);
            border: 1px solid var(--border-color);
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .metric-trend {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .metric-trend.positive {
            color: var(--success-color);
        }

        .metric-trend.negative {
            color: var(--danger-color);
        }

        /* Progress Bar */
        .progress-container {
            background-color: var(--border-color);
            border-radius: 9999px;
            height: 12px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-bar {
            height: 100%;
            background-color: var(--success-color);
            transition: width 0.5s ease;
            border-radius: 9999px;
        }

        .progress-bar.warning {
            background-color: var(--warning-color);
        }

        .progress-bar.danger {
            background-color: var(--danger-color);
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-indicator.success {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .status-indicator.warning {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .status-indicator.danger {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        /* Forms */
        .form-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: calc(var(--radius) / 2);
            background-color: var(--background);
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: calc(var(--radius) / 2);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            text-decoration: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #1d4ed8;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px var(--shadow-md);
        }

        .btn-secondary {
            background-color: var(--border-color);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background-color: #d1d5db;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        .data-table th {
            text-align: left;
            padding: 0.75rem;
            border-bottom: 2px solid var(--border-color);
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }

        .data-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
        }

        .data-table tr:hover {
            background-color: var(--background);
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-background);
            border-radius: var(--radius);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px var(--shadow-md);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0.5rem;
            border-radius: calc(var(--radius) / 2);
            transition: all 0.3s;
        }

        .close-btn:hover {
            background-color: var(--border-color);
            color: var(--text-primary);
        }

        /* Charts Container */
        .chart-container {
            position: relative;
            height: 300px;
            margin: 1rem 0;
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                overflow-x: scroll;
                -webkit-overflow-scrolling: touch;
            }

            .modal-content {
                padding: 1.5rem;
            }

            .data-table {
                font-size: 0.875rem;
            }

            .metric-value {
                font-size: 1.5rem;
            }
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .text-right {
            text-align: right;
        }

        .mb-1 { margin-bottom: 0.5rem; }
        .mb-2 { margin-bottom: 1rem; }
        .mb-3 { margin-bottom: 1.5rem; }
        .mb-4 { margin-bottom: 2rem; }

        .mt-1 { margin-top: 0.5rem; }
        .mt-2 { margin-top: 1rem; }
        .mt-3 { margin-top: 1.5rem; }
        .mt-4 { margin-top: 2rem; }

        .flex {
            display: flex;
        }

        .flex-between {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .gap-1 { gap: 0.5rem; }
        .gap-2 { gap: 1rem; }
        .gap-3 { gap: 1.5rem; }

        /* Loading Spinner */
        .spinner {
            border: 3px solid var(--border-color);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .empty-state-text {
            font-size: 1.125rem;
            margin-bottom: 1rem;
        }


        /* Action Buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .icon-btn {
            background: none;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            color: var(--text-secondary);
            border-radius: calc(var(--radius) / 2);
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background-color: var(--border-color);
            color: var(--text-primary);
        }

        /* Frequency Badge */
        .frequency-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            background-color: var(--border-color);
            color: var(--text-secondary);
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
        }

        /* Amount Display */
        .amount {
            font-weight: 600;
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
        }

        .amount.positive {
            color: var(--success-color);
        }

        .amount.negative {
            color: var(--danger-color);
        }

        /* Quick Stats */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .quick-stat {
            text-align: center;
            padding: 1rem;
            background-color: var(--background);
            border-radius: calc(var(--radius) / 2);
        }

        .quick-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .quick-stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Chart Canvas Styling */
        canvas {
            max-width: 100%;
            height: auto !important;
        }

        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: var(--text-primary);
            color: var(--background);
            text-align: center;
            border-radius: calc(var(--radius) / 2);
            padding: 0.5rem;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .section-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* List Items */
        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background-color: var(--background);
            border-radius: calc(var(--radius) / 2);
            margin-bottom: 0.5rem;
            transition: all 0.3s;
        }

        .list-item:hover {
            transform: translateX(4px);
            box-shadow: 0 2px 4px var(--shadow);
        }

        .list-item-info {
            flex: 1;
        }

        .list-item-title {
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .list-item-details {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .payment-schedule {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
            font-style: italic;
        }

        /* Calendar Styles */
        .calendar-container {
            margin-top: 2rem;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .calendar-nav {
            background: none;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 0.5rem 1rem;
            border-radius: calc(var(--radius) / 2);
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .calendar-nav:hover {
            background-color: var(--border-color);
        }

        .calendar-month-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin: 0;
        }

        .calendar-grid {
            border: 1px solid var(--border-color);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .calendar-weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background-color: var(--background);
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-weekday {
            padding: 0.75rem 0.5rem;
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
            color: var(--text-secondary);
            border-right: 1px solid var(--border-color);
        }

        .calendar-weekday:last-child {
            border-right: none;
        }

        .calendar-days {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
        }

        .calendar-day {
            background: var(--card-background);
            min-height: 100px;
            padding: 0.5rem;
            border-right: 1px solid var(--border-color);
            border-bottom: 1px solid var(--border-color);
            position: relative;
        }

        .calendar-day:nth-child(7n) {
            border-right: none;
        }

        .calendar-day.other-month {
            background-color: var(--background);
            opacity: 0.5;
        }

        .calendar-day.today {
            background-color: rgba(37, 99, 235, 0.1);
        }

        .day-number {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.875rem;
        }

        .day-payments {
            display: flex;
            flex-direction: column;
            gap: 0.125rem;
        }

        .payment-item {
            background-color: var(--primary-color);
            color: white;
            padding: 0.125rem 0.25rem;
            border-radius: 3px;
            font-size: 0.7rem;
            line-height: 1.2;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .payment-item.weekly {
            background-color: var(--success-color);
        }

        .payment-item.biweekly {
            background-color: var(--warning-color);
        }

        .payment-item.annual {
            background-color: var(--danger-color);
        }

        .coast-capital-total {
            background-color: var(--success-color);
            color: white;
            padding: 1rem;
            border-radius: var(--radius);
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .coast-capital-total h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
            opacity: 0.9;
        }

        .coast-capital-total .total-amount {
            font-size: 1.75rem;
            font-weight: 700;
            margin: 0;
        }

        /* Category Styles */
        .category-group {
            margin-bottom: 1.5rem;
        }

        .category-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.5rem;
        }

        .category-items {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .category-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.125rem 0.5rem;
            background-color: rgba(107, 114, 128, 0.1);
            color: var(--text-secondary);
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
            margin-top: 0.25rem;
        }

        .category-badge.software {
            background-color: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }

        .category-badge.streaming {
            background-color: rgba(16, 185, 129, 0.1);
            color: #10b981;
        }

        .category-badge.services {
            background-color: rgba(245, 158, 11, 0.1);
            color: #f59e0b;
        }

        .category-badge.utilities {
            background-color: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        .category-badge.others {
            background-color: rgba(107, 114, 128, 0.1);
            color: #6b7280;
        }

        /* Neo Credit Card Dashboard Styles */
        .neo-dashboard {
            margin-bottom: 2rem;
        }

        .neo-dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .neo-metric-card {
            background: linear-gradient(135deg, #8B5CF6 0%, #A855F7 50%, #C084FC 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(139, 92, 246, 0.25);
            transition: transform 0.2s;
        }

        .neo-metric-card:hover {
            transform: translateY(-2px);
        }

        .neo-metric-label {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-bottom: 0.5rem;
            font-weight: 500;
            letter-spacing: 0.025em;
        }

        .neo-metric-value {
            font-size: 2rem;
            font-weight: 700;
            line-height: 1;
        }

        /* Neo Controls */
        .neo-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            gap: 1rem;
        }

        .neo-controls-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .neo-controls-right {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .search-wrapper {
            position: relative;
        }

        .search-input {
            padding: 0.75rem 1rem 0.75rem 2.5rem;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            background-color: var(--background);
            color: var(--text-primary);
            font-size: 0.875rem;
            width: 250px;
            transition: all 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #2563EB;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 50%;
            transform: translateY(-50%);
            color: #6B7280;
            font-size: 0.875rem;
        }

        .sort-dropdown {
            padding: 0.75rem 1rem;
            border: 1px solid #D1D5DB;
            border-radius: 8px;
            background-color: var(--background);
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sort-dropdown:focus {
            outline: none;
            border-color: #2563EB;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Blue Buttons */
        .btn-blue {
            background-color: #2563EB;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-blue:hover {
            background-color: #1D4ED8;
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(37, 99, 235, 0.25);
        }

        .btn-blue-outline {
            background-color: transparent;
            color: #2563EB;
            border: 1px solid #2563EB;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 500;
            font-size: 0.875rem;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-blue-outline:hover {
            background-color: #2563EB;
            color: white;
            transform: translateY(-1px);
        }

        /* Neo Table */
        .neo-table-container {
            background: var(--card-background);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .neo-table {
            width: 100%;
            border-collapse: collapse;
        }

        .neo-table th {
            background-color: var(--background);
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .neo-table td {
            padding: 0.75rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
        }

        .neo-table tr:last-child td {
            border-bottom: none;
        }

        .neo-table tr:hover {
            background-color: var(--background);
        }

        .neo-item-name {
            font-weight: 600;
            color: var(--text-primary);
        }

        .neo-amount {
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
        }

        .neo-frequency {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .neo-monthly-cost {
            font-weight: 600;
            color: var(--text-primary);
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
        }

        /* Category Tags */
        .neo-category-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .neo-category-tag.software {
            background-color: #EDE9FE;
            color: #7C3AED;
        }

        .neo-category-tag.streaming {
            background-color: #DBEAFE;
            color: #2563EB;
        }

        .neo-category-tag.services {
            background-color: #FEF3C7;
            color: #D97706;
        }

        .neo-category-tag.utilities {
            background-color: #FEE2E2;
            color: #DC2626;
        }

        .neo-category-tag.others {
            background-color: #F3F4F6;
            color: #6B7280;
        }

        /* Action Buttons */
        .neo-actions {
            display: flex;
            gap: 0.5rem;
        }

        .neo-action-btn {
            background: none;
            border: none;
            padding: 0.5rem;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .neo-action-btn:hover {
            background-color: var(--border-color);
        }

        .neo-action-btn.edit:hover {
            background-color: rgba(37, 99, 235, 0.1);
        }

        .neo-action-btn.delete:hover {
            background-color: rgba(239, 68, 68, 0.1);
        }

        /* Empty State */
        .neo-empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-secondary);
        }

        .neo-empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .neo-empty-text {
            font-size: 1.125rem;
            margin-bottom: 1rem;
        }

        /* Notes Section Styles */
        .add-note-card {
            margin-bottom: 1.5rem;
        }

        .note-item {
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 0;
            transition: all 0.2s;
        }

        .note-item:last-child {
            border-bottom: none;
        }

        .note-item:hover {
            background-color: var(--background);
            margin: 0 -1rem;
            padding: 1rem;
            border-radius: 8px;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .note-timestamp {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .note-actions {
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .note-item:hover .note-actions {
            opacity: 1;
        }

        .note-action-btn {
            background: none;
            border: none;
            padding: 0.25rem;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            font-size: 0.875rem;
        }

        .note-action-btn:hover {
            background-color: var(--border-color);
        }

        .note-action-btn.edit:hover {
            background-color: rgba(37, 99, 235, 0.1);
        }

        .note-action-btn.delete:hover {
            background-color: rgba(239, 68, 68, 0.1);
        }

        .note-content {
            color: var(--text-primary);
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .notes-empty-state {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }

        .notes-empty-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .notes-empty-text {
            font-size: 1.125rem;
            margin-bottom: 0.5rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .neo-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .neo-controls-left {
                flex-direction: column;
            }
            
            .search-input {
                width: 100%;
            }
            
            .neo-table {
                font-size: 0.875rem;
            }
            
            .neo-metric-value {
                font-size: 1.5rem;
            }
            
            .note-item:hover {
                margin: 0;
                padding: 1rem 0;
            }
        }

        @media (max-width: 768px) {
            .calendar-day {
                min-height: 80px;
                padding: 0.25rem;
            }
            
            .payment-item {
                font-size: 0.65rem;
            }
            
            .day-number {
                font-size: 0.8rem;
            }
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border-color);
            transition: 0.4s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Import/Export Area */
        .import-export-area {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid var(--border-color);
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            display: inline-block;
            padding: 0.75rem 1.5rem;
            background-color: var(--border-color);
            color: var(--text-primary);
            border-radius: calc(var(--radius) / 2);
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-label:hover {
            background-color: #d1d5db;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <h1 class="logo">💰 Financial Command Center</h1>
                <div class="header-controls">
                    <div class="month-selector">
                        <button id="prevMonth" class="icon-btn">←</button>
                        <span id="currentMonth">January 2025</span>
                        <button id="nextMonth" class="icon-btn">→</button>
                    </div>
                    <button class="theme-toggle" id="themeToggle">🌙</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <div class="container">
        <nav class="nav-tabs">
            <button class="nav-tab active" data-tab="dashboard">Dashboard</button>
            <button class="nav-tab" data-tab="income">Income</button>
            <button class="nav-tab" data-tab="budgetBuddy">Budget Buddy</button>
            <button class="nav-tab" data-tab="expenses">Coast Capital Account</button>
            <button class="nav-tab" data-tab="subscriptions">Neo Credit Card</button>
            <button class="nav-tab" data-tab="notes">Notes</button>
            <button class="nav-tab" data-tab="analytics">Analytics</button>
            <button class="nav-tab" data-tab="settings">Settings</button>
        </nav>
    </div>

    <!-- Main Content -->
    <main class="container">
        <div class="main-content">
            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-content active">
                <div class="dashboard-grid">
                    <!-- Monthly Income Card -->
                    <div class="metric-card">
                        <div class="metric-label">Monthly Income</div>
                        <div class="metric-value amount positive" id="monthlyIncome">$0.00</div>
                        <div class="metric-trend positive">
                            <span>↑</span>
                            <span id="incomeTrend">0% from last month</span>
                        </div>
                    </div>

                    <!-- Total Expenses Card -->
                    <div class="metric-card">
                        <div class="metric-label">Total Monthly Expenses</div>
                        <div class="metric-value amount negative" id="totalExpenses">$0.00</div>
                        <div class="metric-trend negative">
                            <span>↑</span>
                            <span id="expensesTrend">0% from last month</span>
                        </div>
                    </div>

                    <!-- Available for Savings Card -->
                    <div class="metric-card">
                        <div class="metric-label">Available for Savings</div>
                        <div class="metric-value amount" id="availableSavings">$0.00</div>
                        <div class="status-indicator success" id="savingsStatus">
                            <span>●</span>
                            <span>On Track</span>
                        </div>
                    </div>

                    <!-- Days Left Card -->
                    <div class="metric-card">
                        <div class="metric-label">Days Left in Month</div>
                        <div class="metric-value" id="daysLeft">30</div>
                        <div class="progress-container">
                            <div class="progress-bar" id="monthProgress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <!-- Savings Goal Progress -->
                <div class="card">
                    <h2 class="section-title">Monthly Savings Goal Progress</h2>
                    <p class="section-subtitle">Target: $700/month</p>
                    <div class="progress-container" style="height: 24px; margin: 1.5rem 0;">
                        <div class="progress-bar" id="savingsProgress" style="width: 0%"></div>
                    </div>
                    <div class="flex-between">
                        <span class="amount" id="currentSavings">$0</span>
                        <span class="text-secondary">$700 goal</span>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="card mt-3">
                    <h3 class="mb-3">Quick Overview</h3>
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <div class="quick-stat-value" id="totalIncomeItems">0</div>
                            <div class="quick-stat-label">Income Sources</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" id="totalExpenseItems">0</div>
                            <div class="quick-stat-label">Coast Capital</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" id="totalSubscriptions">0</div>
                            <div class="quick-stat-label">Neo Credit Card</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" id="totalBudgetBuddyItems">0</div>
                            <div class="quick-stat-label">Budget Buddy Items</div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Budget Buddy Tab -->
            <div id="budgetBuddy" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Budget Buddy</h2>
                        <p class="section-subtitle">Discretionary spending budget</p>
                    </div>
                    <button class="btn btn-primary" onclick="openAddBudgetBuddyModal()">
                        <span>+</span>
                        <span>Add Budget Item</span>
                    </button>
                </div>

                <div class="card">
                    <div id="budgetBuddyList" class="empty-state">
                        <div class="empty-state-icon">💰</div>
                        <div class="empty-state-text">No budget items added yet</div>
                        <button class="btn btn-primary" onclick="openAddBudgetBuddyModal()">Add Your First Budget Item</button>
                    </div>
                </div>
            </div>

            <!-- Income Tab -->
            <div id="income" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Income Sources</h2>
                        <p class="section-subtitle">Manage your recurring income</p>
                    </div>
                    <button class="btn btn-primary" onclick="openAddIncomeModal()">
                        <span>+</span>
                        <span>Add Income</span>
                    </button>
                </div>

                <div class="card">
                    <div id="incomeList" class="empty-state">
                        <div class="empty-state-icon">💵</div>
                        <div class="empty-state-text">No income sources added yet</div>
                        <button class="btn btn-primary" onclick="openAddIncomeModal()">Add Your First Income Source</button>
                    </div>
                </div>
            </div>

            <!-- Expenses Tab -->
            <div id="expenses" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Coast Capital Account</h2>
                        <p class="section-subtitle">Expenses from your Coast Capital account</p>
                    </div>
                    <button class="btn btn-primary" onclick="openAddExpenseModal()">
                        <span>+</span>
                        <span>Add Expense</span>
                    </button>
                </div>

                <!-- Coast Capital Total -->
                <div class="coast-capital-total">
                    <h3>Monthly Total</h3>
                    <div class="total-amount" id="coastCapitalTotal">$0.00</div>
                </div>

                <div class="card">
                    <div id="expensesList" class="empty-state">
                        <div class="empty-state-icon">🏠</div>
                        <div class="empty-state-text">No Coast Capital expenses added yet</div>
                        <button class="btn btn-primary" onclick="openAddExpenseModal()">Add Your First Expense</button>
                    </div>
                </div>

                <!-- Payment Calendar -->
                <div class="card calendar-container">
                    <h3>Payment Calendar</h3>
                    <div class="calendar-header">
                        <button class="calendar-nav" onclick="changeCalendarMonth(-1)">←</button>
                        <h4 class="calendar-month-title" id="calendarMonthTitle">August 2025</h4>
                        <button class="calendar-nav" onclick="changeCalendarMonth(1)">→</button>
                    </div>
                    <div class="calendar-grid">
                        <div class="calendar-weekdays">
                            <div class="calendar-weekday">Sun</div>
                            <div class="calendar-weekday">Mon</div>
                            <div class="calendar-weekday">Tue</div>
                            <div class="calendar-weekday">Wed</div>
                            <div class="calendar-weekday">Thu</div>
                            <div class="calendar-weekday">Fri</div>
                            <div class="calendar-weekday">Sat</div>
                        </div>
                        <div class="calendar-days" id="calendarDays">
                            <!-- Calendar days will be generated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subscriptions Tab -->
            <div id="subscriptions" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Neo Credit Card</h2>
                        <p class="section-subtitle">Expenses from your Neo credit card</p>
                    </div>
                </div>

                <!-- Neo Dashboard -->
                <div class="neo-dashboard">
                    <div class="neo-dashboard-cards">
                        <div class="neo-metric-card">
                            <div class="neo-metric-label">Total Monthly</div>
                            <div class="neo-metric-value" id="neoTotalMonthly">$0.00</div>
                        </div>
                        <div class="neo-metric-card">
                            <div class="neo-metric-label">Total Annual</div>
                            <div class="neo-metric-value" id="neoTotalAnnual">$0.00</div>
                        </div>
                        <div class="neo-metric-card">
                            <div class="neo-metric-label">Active Subscriptions</div>
                            <div class="neo-metric-value" id="neoActiveCount">0</div>
                        </div>
                    </div>
                </div>

                <!-- Neo Controls -->
                <div class="neo-controls">
                    <div class="neo-controls-left">
                        <div class="search-wrapper">
                            <input type="text" id="neoSearch" placeholder="Search subscriptions..." class="search-input" oninput="filterNeoTable()">
                            <span class="search-icon">🔍</span>
                        </div>
                        <select id="neoSort" class="sort-dropdown" onchange="filterNeoTable()">
                            <option value="name-asc">Name A-Z</option>
                            <option value="name-desc">Name Z-A</option>
                            <option value="amount-desc">Amount High-Low</option>
                            <option value="amount-asc">Amount Low-High</option>
                            <option value="category">Category</option>
                        </select>
                    </div>
                    <div class="neo-controls-right">
                        <div class="file-input-wrapper">
                            <input type="file" id="neoImportFile" accept=".json" onchange="importNeoItems(event)">
                            <label for="neoImportFile" class="btn-blue-outline">
                                <span>📅</span>
                                <span>Import JSON</span>
                            </label>
                        </div>
                        <button class="btn-blue" onclick="openAddSubscriptionModal()">
                            <span>+</span>
                            <span>Add Expense</span>
                        </button>
                    </div>
                </div>

                <!-- Neo Table -->
                <div class="neo-table-container">
                    <table class="neo-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Amount</th>
                                <th>Frequency</th>
                                <th>Category</th>
                                <th>Monthly Cost</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="neoTableBody">
                            <!-- Rows generated by JavaScript -->
                        </tbody>
                    </table>
                    <div id="neoEmptyState" class="neo-empty-state" style="display: none;">
                        <div class="neo-empty-icon">💳</div>
                        <div class="neo-empty-text">No Neo Credit Card expenses found</div>
                        <button class="btn-blue" onclick="openAddSubscriptionModal()">Add Your First Expense</button>
                    </div>
                </div>
            </div>

            <!-- Notes Tab -->
            <div id="notes" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Notes & Reminders</h2>
                        <p class="section-subtitle">Keep track of important financial information</p>
                    </div>
                </div>

                <!-- Add Note Form -->
                <div class="card add-note-card">
                    <h3>Add New Note</h3>
                    <form id="addNoteForm" onsubmit="saveNote(event)">
                        <div class="form-group">
                            <textarea 
                                name="noteContent" 
                                placeholder="Enter your note or reminder..." 
                                rows="3" 
                                required>
                            </textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">
                            <span>💾</span>
                            <span>Save Note</span>
                        </button>
                    </form>
                </div>

                <!-- Notes List -->
                <div class="card">
                    <div id="notesList">
                        <!-- Notes rendered by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Analytics Tab -->
            <div id="analytics" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Financial Analytics</h2>
                        <p class="section-subtitle">Track your financial trends and patterns</p>
                    </div>
                </div>

                <!-- Savings Trend Chart -->
                <div class="card">
                    <h3>Savings Trend (Last 6 Months)</h3>
                    <div class="chart-container">
                        <canvas id="savingsTrendChart"></canvas>
                    </div>
                </div>

                <!-- Expense Breakdown Chart -->
                <div class="card mt-3">
                    <h3>Expense Breakdown</h3>
                    <div class="chart-container">
                        <canvas id="expenseBreakdownChart"></canvas>
                    </div>
                </div>

                <!-- Year to Date Summary -->
                <div class="card mt-3">
                    <h3>Year-to-Date Summary</h3>
                    <div class="quick-stats">
                        <div class="quick-stat">
                            <div class="quick-stat-value amount positive" id="ytdIncome">$0</div>
                            <div class="quick-stat-label">Total Income</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value amount negative" id="ytdExpenses">$0</div>
                            <div class="quick-stat-label">Total Expenses</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value amount" id="ytdSavings">$0</div>
                            <div class="quick-stat-label">Total Saved</div>
                        </div>
                        <div class="quick-stat">
                            <div class="quick-stat-value" id="ytdSavingsRate">0%</div>
                            <div class="quick-stat-label">Savings Rate</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-content">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Settings</h2>
                        <p class="section-subtitle">Manage your preferences and data</p>
                    </div>
                </div>

                <div class="card">
                    <h3>Preferences</h3>
                    <div class="form-group">
                        <label>Monthly Savings Goal</label>
                        <input type="number" id="savingsGoal" value="700" step="50">
                    </div>
                    <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                </div>

                <div class="card mt-3">
                    <h3>Data Management</h3>
                    <div class="import-export-area">
                        <div class="flex gap-2">
                            <button class="btn btn-secondary" onclick="exportData()">
                                <span>📥</span>
                                <span>Export Data</span>
                            </button>
                            <div class="file-input-wrapper">
                                <input type="file" id="importFile" accept=".json" onchange="importData(event)">
                                <label for="importFile" class="file-input-label">
                                    <span>📤</span>
                                    <span>Import Data</span>
                                </label>
                            </div>
                        </div>
                        <p class="text-secondary mt-2">Export your data for backup or import from a previous backup</p>
                    </div>
                </div>

                <div class="card mt-3">
                    <h3>Danger Zone</h3>
                    <p class="text-secondary mb-2">These actions cannot be undone</p>
                    <button class="btn btn-danger" onclick="confirmClearData()">Clear All Data</button>
                </div>
            </div>
        </div>
    </main>

    <!-- Add Income Modal -->
    <div id="addIncomeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Income Source</h2>
                <button class="close-btn" onclick="closeModal('addIncomeModal')">×</button>
            </div>
            <form id="addIncomeForm" onsubmit="saveIncome(event)">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" name="name" required placeholder="e.g., Salary, Freelance Work">
                </div>
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" name="amount" required step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select name="frequency" required>
                        <option value="weekly">Weekly</option>
                        <option value="biweekly">Bi-weekly</option>
                        <option value="monthly" selected>Monthly</option>
                        <option value="annual">Annual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" name="startDate" required>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Save Income</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addIncomeModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Expense Modal -->
    <div id="addExpenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Coast Capital Expense</h2>
                <button class="close-btn" onclick="closeModal('addExpenseModal')">×</button>
            </div>
            <form id="addExpenseForm" onsubmit="saveExpense(event)">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" name="name" required placeholder="e.g., Mortgage, Car Payment">
                </div>
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" name="amount" required step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select name="frequency" required>
                        <option value="weekly">Weekly</option>
                        <option value="biweekly">Bi-weekly</option>
                        <option value="monthly" selected>Monthly</option>
                        <option value="annual">Annual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" name="startDate" required>
                </div>
                <div class="form-group">
                    <label>Payment Day (for monthly payments)</label>
                    <input type="number" name="paymentDay" min="1" max="31" placeholder="15">
                    <small class="text-secondary">Day of month for monthly payments (e.g., 15 for 15th of each month). Leave blank for other frequencies.</small>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Save Expense</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addExpenseModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Subscription Modal -->
    <div id="addSubscriptionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Neo Credit Card Expense</h2>
                <button class="close-btn" onclick="closeModal('addSubscriptionModal')">×</button>
            </div>
            <form id="addSubscriptionForm" onsubmit="saveSubscription(event)">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" name="name" required placeholder="e.g., Netflix, Spotify">
                </div>
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" name="amount" required step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select name="frequency" required>
                        <option value="monthly" selected>Monthly</option>
                        <option value="annual">Annual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Category</label>
                    <select name="neoCategory" required>
                        <option value="">Select a category</option>
                        <option value="software">💻 Software</option>
                        <option value="streaming">📺 Streaming</option>
                        <option value="services">🔧 Services</option>
                        <option value="utilities">⚡ Utilities</option>
                        <option value="others">📦 Others</option>
                    </select>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Save Expense</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addSubscriptionModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Budget Buddy Modal -->
    <div id="addBudgetBuddyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Add Budget Item</h2>
                <button class="close-btn" onclick="closeModal('addBudgetBuddyModal')">×</button>
            </div>
            <form id="addBudgetBuddyForm" onsubmit="saveBudgetBuddy(event)">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" name="name" required placeholder="e.g., Discretionary Spending">
                </div>
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" name="amount" required step="0.01" min="0" placeholder="0.00">
                </div>
                <div class="form-group">
                    <label>Frequency</label>
                    <select name="frequency" required>
                        <option value="weekly">Weekly</option>
                        <option value="biweekly">Bi-weekly</option>
                        <option value="monthly" selected>Monthly</option>
                        <option value="annual">Annual</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Start Date</label>
                    <input type="date" name="startDate" required>
                </div>
                <div class="flex gap-2">
                    <button type="submit" class="btn btn-primary">Save Budget Item</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addBudgetBuddyModal')">Cancel</button>
                </div>
            </form>
        </div>
    </div>


    <!-- Chart.js Library (Minimal Implementation) -->
    <script>
        // Simple Chart Drawing Functions
        function drawLineChart(canvasId, labels, data, color) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 300;
            
            ctx.clearRect(0, 0, width, height);
            
            if (data.length === 0) {
                ctx.fillStyle = 'var(--text-secondary)';
                ctx.font = '14px var(--font-family)';
                ctx.textAlign = 'center';
                ctx.fillText('No data available', width / 2, height / 2);
                return;
            }
            
            // Find min and max values
            const maxValue = Math.max(...data, 700); // Include goal line
            const minValue = 0;
            const range = maxValue - minValue;
            
            // Drawing area
            const padding = 40;
            const chartWidth = width - padding * 2;
            const chartHeight = height - padding * 2;
            
            // Draw axes
            ctx.strokeStyle = 'var(--border-color)';
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Draw goal line at $700
            ctx.strokeStyle = 'var(--success-color)';
            ctx.setLineDash([5, 5]);
            const goalY = height - padding - (700 / maxValue) * chartHeight;
            ctx.beginPath();
            ctx.moveTo(padding, goalY);
            ctx.lineTo(width - padding, goalY);
            ctx.stroke();
            ctx.setLineDash([]);
            
            // Draw data points and lines
            ctx.strokeStyle = color;
            ctx.fillStyle = color;
            ctx.lineWidth = 2;
            
            const pointSpacing = chartWidth / (data.length - 1 || 1);
            
            ctx.beginPath();
            data.forEach((value, index) => {
                const x = padding + index * pointSpacing;
                const y = height - padding - (value / maxValue) * chartHeight;
                
                if (index === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            ctx.stroke();
            
            // Draw points
            data.forEach((value, index) => {
                const x = padding + index * pointSpacing;
                const y = height - padding - (value / maxValue) * chartHeight;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
            
            // Draw labels
            ctx.fillStyle = 'var(--text-secondary)';
            ctx.font = '12px var(--font-family)';
            ctx.textAlign = 'center';
            
            labels.forEach((label, index) => {
                const x = padding + index * pointSpacing;
                ctx.fillText(label, x, height - padding + 20);
            });
        }

        function drawPieChart(canvasId, labels, data, colors) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 300;
            
            ctx.clearRect(0, 0, width, height);
            
            if (data.length === 0 || data.reduce((a, b) => a + b, 0) === 0) {
                ctx.fillStyle = 'var(--text-secondary)';
                ctx.font = '14px var(--font-family)';
                ctx.textAlign = 'center';
                ctx.fillText('No data available', width / 2, height / 2);
                return;
            }
            
            const centerX = width / 2;
            const centerY = height / 2;
            const radius = Math.min(width, height) / 3;
            
            const total = data.reduce((a, b) => a + b, 0);
            let currentAngle = -Math.PI / 2;
            
            data.forEach((value, index) => {
                const sliceAngle = (value / total) * Math.PI * 2;
                
                // Draw slice
                ctx.fillStyle = colors[index % colors.length];
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, currentAngle, currentAngle + sliceAngle);
                ctx.closePath();
                ctx.fill();
                
                // Draw label
                const labelAngle = currentAngle + sliceAngle / 2;
                const labelX = centerX + Math.cos(labelAngle) * (radius * 1.3);
                const labelY = centerY + Math.sin(labelAngle) * (radius * 1.3);
                
                ctx.fillStyle = 'var(--text-primary)';
                ctx.font = '12px var(--font-family)';
                ctx.textAlign = labelX > centerX ? 'left' : 'right';
                ctx.fillText(`${labels[index]} (${((value / total) * 100).toFixed(1)}%)`, labelX, labelY);
                
                currentAngle += sliceAngle;
            });
        }
    </script>

    <!-- Main JavaScript -->
    <script>
        // Data Models
        class FinancialData {
            constructor() {
                this.income = [];
                this.budgetBuddy = [];
                this.expenses = [];
                this.subscriptions = [];
                this.monthlyVariables = {}; // Keep for backwards compatibility
                this.notes = []; // New notes array
                this.settings = {
                    savingsGoal: 700,
                    theme: 'light'
                };
                this.currentMonth = new Date().toISOString().slice(0, 7);
                this.initializeDefaultBudgetBuddy();
            }

            initializeDefaultBudgetBuddy() {
                if (this.budgetBuddy.length === 0) {
                    this.budgetBuddy.push({
                        id: 'default-budget-buddy',
                        name: 'Discretionary Spending',
                        amount: 750,
                        frequency: 'monthly',
                        category: 'budget_buddy',
                        startDate: new Date().toISOString().slice(0, 10),
                        isActive: true
                    });
                }
            }

            load() {
                const saved = localStorage.getItem('financialData');
                if (saved) {
                    const data = JSON.parse(saved);
                    Object.assign(this, data);
                    // Ensure budgetBuddy array exists for backwards compatibility
                    if (!this.budgetBuddy) {
                        this.budgetBuddy = [];
                    }
                    // Ensure notes array exists for backwards compatibility
                    if (!this.notes) {
                        this.notes = [];
                    }
                    // Remove old budgetBuddyLimit from settings
                    if (this.settings && this.settings.budgetBuddyLimit !== undefined) {
                        delete this.settings.budgetBuddyLimit;
                    }
                }
                this.initializeDefaultBudgetBuddy();
            }

            save() {
                localStorage.setItem('financialData', JSON.stringify(this));
            }

            calculateMonthlyAmount(item) {
                const amount = parseFloat(item.amount);
                switch (item.frequency) {
                    case 'weekly':
                        return amount * 52 / 12;
                    case 'biweekly':
                        return amount * 26 / 12;
                    case 'monthly':
                        return amount;
                    case 'annual':
                        return amount / 12;
                    default:
                        return amount;
                }
            }

            getMonthlyIncome() {
                return this.income
                    .filter(item => item.isActive)
                    .reduce((total, item) => total + this.calculateMonthlyAmount(item), 0);
            }

            getMonthlyExpenses() {
                const budgetBuddy = this.budgetBuddy
                    .filter(item => item.isActive)
                    .reduce((total, item) => total + this.calculateMonthlyAmount(item), 0);
                
                const fixed = this.expenses
                    .filter(item => item.isActive)
                    .reduce((total, item) => total + this.calculateMonthlyAmount(item), 0);
                
                const subs = this.subscriptions
                    .filter(item => item.isActive)
                    .reduce((total, item) => total + this.calculateMonthlyAmount(item), 0);
                
                const variables = this.monthlyVariables[this.currentMonth] || { otherExpenses: 0 };
                
                return budgetBuddy + fixed + subs + variables.otherExpenses;
            }

            getAvailableForSavings() {
                return this.getMonthlyIncome() - this.getMonthlyExpenses();
            }
        }

        // Initialize data
        const financialData = new FinancialData();
        financialData.load();

        // Calendar state
        let calendarCurrentMonth = new Date().getMonth();
        let calendarCurrentYear = new Date().getFullYear();

        // Neo Credit Card Categories
        const NEO_CATEGORIES = {
            'software': { name: 'Software', icon: '💻', color: '#3b82f6' },
            'streaming': { name: 'Streaming', icon: '📺', color: '#10b981' },
            'services': { name: 'Services', icon: '🔧', color: '#f59e0b' },
            'utilities': { name: 'Utilities', icon: '⚡', color: '#ef4444' },
            'others': { name: 'Others', icon: '📦', color: '#6b7280' }
        };

        // UI Helper Functions
        function $(id) {
            return document.getElementById(id);
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Payment Schedule Formatting Functions
        function formatPaymentSchedule(expense) {
            if (!expense.frequency) return '';
            
            const startDate = new Date(expense.startDate);
            const dayOfWeek = startDate.toLocaleDateString('en-US', { weekday: 'long' });
            const monthDay = startDate.getDate();
            
            switch (expense.frequency) {
                case 'weekly':
                    return `Weekly on ${dayOfWeek}s`;
                case 'biweekly':
                    return `Bi-weekly starting ${startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
                case 'monthly':
                    const paymentDay = expense.paymentDay || monthDay;
                    return `Monthly on the ${getOrdinalSuffix(paymentDay)}`;
                case 'annual':
                    return `Annual on ${startDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}`;
                default:
                    return expense.frequency;
            }
        }

        function getOrdinalSuffix(day) {
            if (day >= 11 && day <= 13) {
                return day + 'th';
            }
            switch (day % 10) {
                case 1: return day + 'st';
                case 2: return day + 'nd';
                case 3: return day + 'rd';
                default: return day + 'th';
            }
        }

        function getNextPaymentDate(expense) {
            if (!expense.frequency || !expense.startDate) return null;
            
            const today = new Date();
            const startDate = new Date(expense.startDate);
            let nextDate = new Date(startDate);
            
            switch (expense.frequency) {
                case 'weekly':
                    // Find next occurrence of the same day of week
                    const daysDiff = (startDate.getDay() - today.getDay() + 7) % 7;
                    nextDate = new Date(today);
                    nextDate.setDate(today.getDate() + (daysDiff === 0 ? 7 : daysDiff));
                    break;
                    
                case 'biweekly':
                    // Calculate next biweekly payment
                    const daysSinceStart = Math.floor((today - startDate) / (1000 * 60 * 60 * 24));
                    const cyclesSinceStart = Math.floor(daysSinceStart / 14);
                    nextDate = new Date(startDate);
                    nextDate.setDate(startDate.getDate() + (cyclesSinceStart + 1) * 14);
                    break;
                    
                case 'monthly':
                    const paymentDay = expense.paymentDay || startDate.getDate();
                    nextDate = new Date(today.getFullYear(), today.getMonth(), paymentDay);
                    if (nextDate <= today) {
                        nextDate.setMonth(nextDate.getMonth() + 1);
                    }
                    // Handle months with fewer days
                    if (nextDate.getDate() !== paymentDay) {
                        nextDate = new Date(nextDate.getFullYear(), nextDate.getMonth() + 1, 0); // Last day of month
                    }
                    break;
                    
                case 'annual':
                    nextDate = new Date(today.getFullYear(), startDate.getMonth(), startDate.getDate());
                    if (nextDate <= today) {
                        nextDate.setFullYear(nextDate.getFullYear() + 1);
                    }
                    break;
                    
                default:
                    return null;
            }
            
            return nextDate;
        }

        // Calendar Functions
        function calculatePaymentOccurrences(expense, year, month) {
            if (!expense.isActive || !expense.startDate) return [];
            
            const startDate = new Date(expense.startDate);
            const occurrences = [];
            
            switch (expense.frequency) {
                case 'weekly':
                    return getWeeklyOccurrences(startDate, year, month);
                case 'biweekly':
                    return getBiweeklyOccurrences(startDate, year, month);
                case 'monthly':
                    return getMonthlyOccurrences(expense, year, month);
                case 'annual':
                    return getAnnualOccurrences(startDate, year, month);
                default:
                    return [];
            }
        }

        function getWeeklyOccurrences(startDate, year, month) {
            const occurrences = [];
            const targetDayOfWeek = startDate.getDay();
            const monthStart = new Date(year, month, 1);
            const monthEnd = new Date(year, month + 1, 0);
            
            // Find first occurrence of the weekday in the month
            let current = new Date(monthStart);
            while (current.getDay() !== targetDayOfWeek) {
                current.setDate(current.getDate() + 1);
            }
            
            // Add all weekly occurrences in the month
            while (current <= monthEnd) {
                if (current >= startDate) {
                    occurrences.push(new Date(current));
                }
                current.setDate(current.getDate() + 7);
            }
            
            return occurrences;
        }

        function getBiweeklyOccurrences(startDate, year, month) {
            const occurrences = [];
            const monthStart = new Date(year, month, 1);
            const monthEnd = new Date(year, month + 1, 0);
            
            // Calculate days since start date to find the biweekly cycle
            const daysSinceStart = Math.floor((monthStart - startDate) / (1000 * 60 * 60 * 24));
            
            // Find the first occurrence in or after the target month
            let cycleOffset = daysSinceStart >= 0 ? Math.ceil(daysSinceStart / 14) : 0;
            
            // Generate all biweekly occurrences that fall within the target month
            while (true) {
                const occurrenceDate = new Date(startDate);
                occurrenceDate.setDate(startDate.getDate() + (cycleOffset * 14));
                
                // If we've passed the end of the month, stop
                if (occurrenceDate > monthEnd) {
                    break;
                }
                
                // If this occurrence is within the target month and after/on start date, add it
                if (occurrenceDate >= monthStart && occurrenceDate >= startDate) {
                    occurrences.push(new Date(occurrenceDate));
                }
                
                cycleOffset++;
            }
            
            return occurrences;
        }

        function getMonthlyOccurrences(expense, year, month) {
            const startDate = new Date(expense.startDate);
            const paymentDay = expense.paymentDay || startDate.getDate();
            
            // Only include if the expense has started by this month
            if (year < startDate.getFullYear() || (year === startDate.getFullYear() && month < startDate.getMonth())) {
                return [];
            }
            
            let paymentDate = new Date(year, month, paymentDay);
            
            // Handle months with fewer days (e.g., Feb 30th becomes Feb 28th)
            if (paymentDate.getMonth() !== month) {
                paymentDate = new Date(year, month + 1, 0); // Last day of the month
            }
            
            return [paymentDate];
        }

        function getAnnualOccurrences(startDate, year, month) {
            // Only show if it's the anniversary month and year >= start year
            if (startDate.getMonth() === month && year >= startDate.getFullYear()) {
                const anniversaryDate = new Date(year, month, startDate.getDate());
                return [anniversaryDate];
            }
            return [];
        }

        function generateCalendarForMonth(year, month) {
            const monthStart = new Date(year, month, 1);
            const monthEnd = new Date(year, month + 1, 0);
            const firstDayOfWeek = monthStart.getDay();
            const daysInMonth = monthEnd.getDate();
            
            // Get all payment occurrences for this month
            const paymentsByDate = {};
            
            financialData.expenses.forEach(expense => {
                const occurrences = calculatePaymentOccurrences(expense, year, month);
                occurrences.forEach(date => {
                    const dateKey = date.getDate();
                    if (!paymentsByDate[dateKey]) {
                        paymentsByDate[dateKey] = [];
                    }
                    paymentsByDate[dateKey].push({
                        name: expense.name,
                        amount: expense.amount,
                        frequency: expense.frequency
                    });
                });
            });
            
            return {
                year,
                month,
                firstDayOfWeek,
                daysInMonth,
                paymentsByDate
            };
        }

        function renderCalendar() {
            const calendarData = generateCalendarForMonth(calendarCurrentYear, calendarCurrentMonth);
            const calendarDays = $('calendarDays');
            const today = new Date();
            
            // Update month title
            const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                               'July', 'August', 'September', 'October', 'November', 'December'];
            $('calendarMonthTitle').textContent = `${monthNames[calendarCurrentMonth]} ${calendarCurrentYear}`;
            
            let html = '';
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < calendarData.firstDayOfWeek; i++) {
                const prevMonth = calendarCurrentMonth === 0 ? 11 : calendarCurrentMonth - 1;
                const prevYear = calendarCurrentMonth === 0 ? calendarCurrentYear - 1 : calendarCurrentYear;
                const prevMonthDays = new Date(prevYear, prevMonth + 1, 0).getDate();
                const dayNum = prevMonthDays - calendarData.firstDayOfWeek + i + 1;
                
                html += `<div class="calendar-day other-month"><div class="day-number">${dayNum}</div></div>`;
            }
            
            // Add days of the current month
            for (let day = 1; day <= calendarData.daysInMonth; day++) {
                const isToday = today.getFullYear() === calendarCurrentYear && 
                               today.getMonth() === calendarCurrentMonth && 
                               today.getDate() === day;
                
                const payments = calendarData.paymentsByDate[day] || [];
                const paymentsHtml = payments.map(payment => 
                    `<div class="payment-item ${payment.frequency}" title="${payment.name}: ${formatCurrency(payment.amount)}">
                        <div>${payment.name}</div>
                        <div>${formatCurrency(payment.amount)}</div>
                    </div>`
                ).join('');
                
                html += `
                    <div class="calendar-day ${isToday ? 'today' : ''}">
                        <div class="day-number">${day}</div>
                        <div class="day-payments">${paymentsHtml}</div>
                    </div>
                `;
            }
            
            // Fill remaining cells if needed
            const totalCells = Math.ceil((calendarData.firstDayOfWeek + calendarData.daysInMonth) / 7) * 7;
            const remainingCells = totalCells - (calendarData.firstDayOfWeek + calendarData.daysInMonth);
            
            for (let day = 1; day <= remainingCells; day++) {
                html += `<div class="calendar-day other-month"><div class="day-number">${day}</div></div>`;
            }
            
            calendarDays.innerHTML = html;
        }

        function changeCalendarMonth(direction) {
            calendarCurrentMonth += direction;
            
            if (calendarCurrentMonth < 0) {
                calendarCurrentMonth = 11;
                calendarCurrentYear--;
            } else if (calendarCurrentMonth > 11) {
                calendarCurrentMonth = 0;
                calendarCurrentYear++;
            }
            
            renderCalendar();
        }

        // Theme Management
        function initTheme() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
            updateThemeIcon(theme);
        }

        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        }

        function updateThemeIcon(theme) {
            $('themeToggle').textContent = theme === 'light' ? '🌙' : '☀️';
        }

        // Navigation
        function initNavigation() {
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    showTab(tabName);
                    
                    // Update active states
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                });
            });
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const activeTab = $(tabName);
            if (activeTab) {
                activeTab.classList.add('active');
                
                // Refresh content based on tab
                switch (tabName) {
                    case 'dashboard':
                        updateDashboard();
                        break;
                    case 'income':
                        renderIncomeList();
                        break;
                    case 'budgetBuddy':
                        renderBudgetBuddyList();
                        break;
                    case 'expenses':
                        renderExpensesList();
                        break;
                    case 'subscriptions':
                        renderSubscriptionsList();
                        break;
                    case 'notes':
                        renderNotesList();
                        break;
                    case 'analytics':
                        updateAnalytics();
                        break;
                    case 'settings':
                        loadSettings();
                        break;
                }
            }
        }

        // Month Navigation
        function initMonthNavigation() {
            updateMonthDisplay();
            
            $('prevMonth').addEventListener('click', () => {
                const [year, month] = financialData.currentMonth.split('-').map(Number);
                const date = new Date(year, month - 2); // -2 because month is 1-indexed and we want previous
                financialData.currentMonth = date.toISOString().slice(0, 7);
                updateMonthDisplay();
                updateDashboard();
            });
            
            $('nextMonth').addEventListener('click', () => {
                const [year, month] = financialData.currentMonth.split('-').map(Number);
                const date = new Date(year, month); // month is already the next month due to 0-indexing
                financialData.currentMonth = date.toISOString().slice(0, 7);
                updateMonthDisplay();
                updateDashboard();
            });
        }

        function updateMonthDisplay() {
            const [year, month] = financialData.currentMonth.split('-');
            const date = new Date(year, month - 1);
            const monthName = date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
            $('currentMonth').textContent = monthName;
        }

        // Dashboard Updates
        function updateDashboard() {
            const income = financialData.getMonthlyIncome();
            const expenses = financialData.getMonthlyExpenses();
            const available = financialData.getAvailableForSavings();
            
            // Update main metrics
            $('monthlyIncome').textContent = formatCurrency(income);
            $('totalExpenses').textContent = formatCurrency(expenses);
            $('availableSavings').textContent = formatCurrency(available);
            $('availableSavings').className = `metric-value amount ${available >= 0 ? 'positive' : 'negative'}`;
            
            // Update savings status
            const savingsStatus = $('savingsStatus');
            if (available >= financialData.settings.savingsGoal) {
                savingsStatus.className = 'status-indicator success';
                savingsStatus.innerHTML = '<span>●</span><span>On Track</span>';
            } else if (available >= financialData.settings.savingsGoal * 0.8) {
                savingsStatus.className = 'status-indicator warning';
                savingsStatus.innerHTML = '<span>●</span><span>Close to Goal</span>';
            } else {
                savingsStatus.className = 'status-indicator danger';
                savingsStatus.innerHTML = '<span>●</span><span>Below Goal</span>';
            }
            
            // Update days left
            const now = new Date();
            const [year, month] = financialData.currentMonth.split('-').map(Number);
            const daysInMonth = new Date(year, month, 0).getDate();
            const currentDay = now.getMonth() === month - 1 ? now.getDate() : 1;
            const daysLeft = Math.max(0, daysInMonth - currentDay + 1);
            
            $('daysLeft').textContent = daysLeft;
            $('monthProgress').style.width = `${((daysInMonth - daysLeft) / daysInMonth) * 100}%`;
            
            // Update savings progress
            const savingsProgress = Math.min(100, (available / financialData.settings.savingsGoal) * 100);
            $('savingsProgress').style.width = `${savingsProgress}%`;
            $('savingsProgress').className = `progress-bar ${available >= financialData.settings.savingsGoal ? 'success' : available >= 0 ? 'warning' : 'danger'}`;
            $('currentSavings').textContent = formatCurrency(Math.max(0, available));
            
            // Update quick stats
            $('totalIncomeItems').textContent = financialData.income.filter(i => i.isActive).length;
            $('totalBudgetBuddyItems').textContent = financialData.budgetBuddy.filter(i => i.isActive).length;
            $('totalExpenseItems').textContent = financialData.expenses.filter(i => i.isActive).length;
            $('totalSubscriptions').textContent = financialData.subscriptions.filter(i => i.isActive).length;
        }

        // Modal Functions
        function openModal(modalId) {
            $(modalId).classList.add('active');
        }

        function closeModal(modalId) {
            $(modalId).classList.remove('active');
            $(modalId).querySelector('form')?.reset();
        }

        // Income Management
        function openAddIncomeModal() {
            $('addIncomeForm').reset();
            $('addIncomeForm').dataset.editId = '';
            $('addIncomeModal').querySelector('.modal-title').textContent = 'Add Income Source';
            openModal('addIncomeModal');
        }

        function saveIncome(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            const income = {
                id: form.dataset.editId || generateId(),
                name: formData.get('name'),
                amount: parseFloat(formData.get('amount')),
                frequency: formData.get('frequency'),
                category: 'income',
                startDate: formData.get('startDate'),
                isActive: true
            };
            
            if (form.dataset.editId) {
                const index = financialData.income.findIndex(i => i.id === form.dataset.editId);
                if (index !== -1) {
                    financialData.income[index] = income;
                }
            } else {
                financialData.income.push(income);
            }
            
            financialData.save();
            closeModal('addIncomeModal');
            renderIncomeList();
            updateDashboard();
        }

        function renderIncomeList() {
            const container = $('incomeList');
            
            if (financialData.income.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">💵</div>
                        <div class="empty-state-text">No income sources added yet</div>
                        <button class="btn btn-primary" onclick="openAddIncomeModal()">Add Your First Income Source</button>
                    </div>
                `;
                return;
            }
            
            const incomeHtml = financialData.income.map(item => `
                <div class="list-item">
                    <div class="list-item-info">
                        <div class="list-item-title">${item.name}</div>
                        <div class="list-item-details">
                            <span class="amount positive">${formatCurrency(item.amount)}</span>
                            <span class="frequency-badge">${item.frequency}</span>
                            <span class="text-secondary">≈ ${formatCurrency(financialData.calculateMonthlyAmount(item))}/month</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="icon-btn" onclick="editIncome('${item.id}')">✏️</button>
                        <button class="icon-btn" onclick="toggleItem('income', '${item.id}')">${item.isActive ? '✓' : '⏸'}</button>
                        <button class="icon-btn" onclick="deleteItem('income', '${item.id}')">🗑️</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = incomeHtml;
        }

        function editIncome(id) {
            const income = financialData.income.find(i => i.id === id);
            if (!income) return;
            
            const form = $('addIncomeForm');
            form.dataset.editId = id;
            form.name.value = income.name;
            form.amount.value = income.amount;
            form.frequency.value = income.frequency;
            form.startDate.value = income.startDate;
            
            $('addIncomeModal').querySelector('.modal-title').textContent = 'Edit Income Source';
            openModal('addIncomeModal');
        }

        // Budget Buddy Management
        function openAddBudgetBuddyModal() {
            $('addBudgetBuddyForm').reset();
            $('addBudgetBuddyForm').dataset.editId = '';
            $('addBudgetBuddyModal').querySelector('.modal-title').textContent = 'Add Budget Item';
            openModal('addBudgetBuddyModal');
        }

        function saveBudgetBuddy(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            const budgetItem = {
                id: form.dataset.editId || generateId(),
                name: formData.get('name'),
                amount: parseFloat(formData.get('amount')),
                frequency: formData.get('frequency'),
                category: 'budget_buddy',
                startDate: formData.get('startDate'),
                isActive: true
            };
            
            if (form.dataset.editId) {
                const index = financialData.budgetBuddy.findIndex(i => i.id === form.dataset.editId);
                if (index !== -1) {
                    financialData.budgetBuddy[index] = budgetItem;
                }
            } else {
                financialData.budgetBuddy.push(budgetItem);
            }
            
            financialData.save();
            closeModal('addBudgetBuddyModal');
            renderBudgetBuddyList();
            updateDashboard();
        }

        function renderBudgetBuddyList() {
            const container = $('budgetBuddyList');
            
            if (financialData.budgetBuddy.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">💰</div>
                        <div class="empty-state-text">No budget items added yet</div>
                        <button class="btn btn-primary" onclick="openAddBudgetBuddyModal()">Add Your First Budget Item</button>
                    </div>
                `;
                return;
            }
            
            const budgetHtml = financialData.budgetBuddy.map(item => `
                <div class="list-item">
                    <div class="list-item-info">
                        <div class="list-item-title">${item.name}</div>
                        <div class="list-item-details">
                            <span class="amount negative">${formatCurrency(item.amount)}</span>
                            <span class="frequency-badge">${item.frequency}</span>
                            <span class="text-secondary">≈ ${formatCurrency(financialData.calculateMonthlyAmount(item))}/month</span>
                        </div>
                    </div>
                    <div class="action-buttons">
                        <button class="icon-btn" onclick="editBudgetBuddy('${item.id}')">✏️</button>
                        <button class="icon-btn" onclick="toggleItem('budgetBuddy', '${item.id}')">${item.isActive ? '✓' : '⏸'}</button>
                        <button class="icon-btn" onclick="deleteItem('budgetBuddy', '${item.id}')">🗑️</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = budgetHtml;
        }

        function editBudgetBuddy(id) {
            const budgetItem = financialData.budgetBuddy.find(i => i.id === id);
            if (!budgetItem) return;
            
            const form = $('addBudgetBuddyForm');
            form.dataset.editId = id;
            form.name.value = budgetItem.name;
            form.amount.value = budgetItem.amount;
            form.frequency.value = budgetItem.frequency;
            form.startDate.value = budgetItem.startDate;
            
            $('addBudgetBuddyModal').querySelector('.modal-title').textContent = 'Edit Budget Item';
            openModal('addBudgetBuddyModal');
        }

        // Expense Management
        function openAddExpenseModal() {
            $('addExpenseForm').reset();
            $('addExpenseForm').dataset.editId = '';
            $('addExpenseModal').querySelector('.modal-title').textContent = 'Add Coast Capital Expense';
            openModal('addExpenseModal');
        }

        function saveExpense(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            const expense = {
                id: form.dataset.editId || generateId(),
                name: formData.get('name'),
                amount: parseFloat(formData.get('amount')),
                frequency: formData.get('frequency'),
                category: 'fixed_expense',
                startDate: formData.get('startDate'),
                paymentDay: formData.get('paymentDay') ? parseInt(formData.get('paymentDay')) : null,
                isActive: true
            };
            
            if (form.dataset.editId) {
                const index = financialData.expenses.findIndex(e => e.id === form.dataset.editId);
                if (index !== -1) {
                    financialData.expenses[index] = expense;
                }
            } else {
                financialData.expenses.push(expense);
            }
            
            financialData.save();
            closeModal('addExpenseModal');
            renderExpensesList();
            updateDashboard();
        }

        function renderExpensesList() {
            const container = $('expensesList');
            
            // Update Coast Capital total
            const coastCapitalTotal = financialData.expenses
                .filter(expense => expense.isActive)
                .reduce((total, expense) => total + financialData.calculateMonthlyAmount(expense), 0);
            $('coastCapitalTotal').textContent = formatCurrency(coastCapitalTotal);
            
            if (financialData.expenses.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🏠</div>
                        <div class="empty-state-text">No Coast Capital expenses added yet</div>
                        <button class="btn btn-primary" onclick="openAddExpenseModal()">Add Your First Expense</button>
                    </div>
                `;
                renderCalendar();
                return;
            }
            
            const expensesHtml = financialData.expenses.map(item => {
                const paymentSchedule = formatPaymentSchedule(item);
                const nextPayment = getNextPaymentDate(item);
                const nextPaymentText = nextPayment ? `Next: ${nextPayment.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}` : '';
                
                return `
                    <div class="list-item">
                        <div class="list-item-info">
                            <div class="list-item-title">${item.name}</div>
                            <div class="list-item-details">
                                <span class="amount negative">${formatCurrency(item.amount)}</span>
                                <span class="frequency-badge">${item.frequency}</span>
                                <span class="text-secondary">≈ ${formatCurrency(financialData.calculateMonthlyAmount(item))}/month</span>
                            </div>
                            ${paymentSchedule ? `
                                <div class="payment-schedule">
                                    <span class="text-secondary">📅 ${paymentSchedule}${nextPaymentText ? ` | ${nextPaymentText}` : ''}</span>
                                </div>
                            ` : ''}
                        </div>
                        <div class="action-buttons">
                            <button class="icon-btn" onclick="editExpense('${item.id}')">✏️</button>
                            <button class="icon-btn" onclick="toggleItem('expenses', '${item.id}')">${item.isActive ? '✓' : '⏸'}</button>
                            <button class="icon-btn" onclick="deleteItem('expenses', '${item.id}')">🗑️</button>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = expensesHtml;
            renderCalendar();
        }

        function editExpense(id) {
            const expense = financialData.expenses.find(e => e.id === id);
            if (!expense) return;
            
            const form = $('addExpenseForm');
            form.dataset.editId = id;
            form.name.value = expense.name;
            form.amount.value = expense.amount;
            form.frequency.value = expense.frequency;
            form.startDate.value = expense.startDate;
            form.paymentDay.value = expense.paymentDay || '';
            
            $('addExpenseModal').querySelector('.modal-title').textContent = 'Edit Coast Capital Expense';
            openModal('addExpenseModal');
        }

        // Subscription Management
        function openAddSubscriptionModal() {
            $('addSubscriptionForm').reset();
            $('addSubscriptionForm').dataset.editId = '';
            $('addSubscriptionModal').querySelector('.modal-title').textContent = 'Add Neo Credit Card Expense';
            openModal('addSubscriptionModal');
        }

        function saveSubscription(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            const subscription = {
                id: form.dataset.editId || generateId(),
                name: formData.get('name'),
                amount: parseFloat(formData.get('amount')),
                frequency: formData.get('frequency'),
                category: 'subscription',
                neoCategory: formData.get('neoCategory'),
                startDate: new Date().toISOString().slice(0, 10), // Default to today since no start date field
                isActive: true
            };
            
            if (form.dataset.editId) {
                const index = financialData.subscriptions.findIndex(s => s.id === form.dataset.editId);
                if (index !== -1) {
                    financialData.subscriptions[index] = subscription;
                }
            } else {
                financialData.subscriptions.push(subscription);
            }
            
            financialData.save();
            closeModal('addSubscriptionModal');
            renderSubscriptionsList();
            updateDashboard();
        }

        function renderSubscriptionsList() {
            updateNeoDashboard();
            filterNeoTable();
        }

        function updateNeoDashboard() {
            const activeSubscriptions = financialData.subscriptions.filter(s => s.isActive);
            const totalMonthly = activeSubscriptions.reduce((sum, sub) => 
                sum + financialData.calculateMonthlyAmount(sub), 0);
            
            $('neoTotalMonthly').textContent = formatCurrency(totalMonthly);
            $('neoTotalAnnual').textContent = formatCurrency(totalMonthly * 12);
            $('neoActiveCount').textContent = activeSubscriptions.length;
        }

        function filterNeoTable() {
            const searchTerm = $('neoSearch').value.toLowerCase();
            const sortBy = $('neoSort').value;
            const tableBody = $('neoTableBody');
            const emptyState = $('neoEmptyState');
            
            // Filter active subscriptions
            let filteredItems = financialData.subscriptions.filter(sub => 
                sub.isActive && sub.name.toLowerCase().includes(searchTerm)
            );
            
            // Sort items
            filteredItems.sort((a, b) => {
                switch (sortBy) {
                    case 'name-asc':
                        return a.name.localeCompare(b.name);
                    case 'name-desc':
                        return b.name.localeCompare(a.name);
                    case 'amount-desc':
                        return b.amount - a.amount;
                    case 'amount-asc':
                        return a.amount - b.amount;
                    case 'category':
                        const categoryA = (a.neoCategory || 'others');
                        const categoryB = (b.neoCategory || 'others');
                        if (categoryA === categoryB) {
                            return a.name.localeCompare(b.name);
                        }
                        return categoryA.localeCompare(categoryB);
                    default:
                        return 0;
                }
            });
            
            if (filteredItems.length === 0) {
                tableBody.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }
            
            tableBody.style.display = '';
            emptyState.style.display = 'none';
            
            // Render table rows
            const rowsHtml = filteredItems.map(item => {
                const categoryInfo = getCategoryInfo(item.neoCategory || 'others');
                const monthlyAmount = financialData.calculateMonthlyAmount(item);
                
                return `
                    <tr>
                        <td>
                            <div class="neo-item-name">${item.name}</div>
                        </td>
                        <td>
                            <div class="neo-amount">${formatCurrency(item.amount)}</div>
                        </td>
                        <td>
                            <div class="neo-frequency">${item.frequency}</div>
                        </td>
                        <td>
                            <span class="neo-category-tag ${item.neoCategory || 'others'}">${categoryInfo.name}</span>
                        </td>
                        <td>
                            <div class="neo-monthly-cost">${formatCurrency(monthlyAmount)}</div>
                        </td>
                        <td>
                            <div class="neo-actions">
                                <button class="neo-action-btn edit" onclick="editSubscription('${item.id}')" title="Edit">
                                    <span>✏️</span>
                                </button>
                                <button class="neo-action-btn delete" onclick="deleteItem('subscriptions', '${item.id}')" title="Delete">
                                    <span>🗑️</span>
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            tableBody.innerHTML = rowsHtml;
        }

        function editSubscription(id) {
            const subscription = financialData.subscriptions.find(s => s.id === id);
            if (!subscription) return;
            
            const form = $('addSubscriptionForm');
            form.dataset.editId = id;
            form.name.value = subscription.name;
            form.amount.value = subscription.amount;
            form.frequency.value = subscription.frequency;
            form.neoCategory.value = subscription.neoCategory || 'others';
            
            $('addSubscriptionModal').querySelector('.modal-title').textContent = 'Edit Neo Credit Card Expense';
            openModal('addSubscriptionModal');
        }

        // Neo Credit Card JSON Import Functions
        function importNeoItems(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    console.log('Parsed JSON data:', data);
                    
                    // Support multiple JSON structures
                    let items = [];
                    if (Array.isArray(data)) {
                        items = data;
                    } else if (data.expenses && Array.isArray(data.expenses)) {
                        items = data.expenses;
                        console.log('Found expenses array with', items.length, 'items');
                    } else if (data.neoItems && Array.isArray(data.neoItems)) {
                        items = data.neoItems;
                    } else if (data.items && Array.isArray(data.items)) {
                        items = data.items;
                    }
                    
                    console.log('Items to process:', items.length);
                    
                    if (!Array.isArray(items) || items.length === 0) {
                        throw new Error('No valid expense items found. Expected "expenses" array or direct array of items.');
                    }
                    
                    let imported = 0;
                    let skipped = 0;
                    
                    items.forEach((item, index) => {
                        console.log(`Processing item ${index + 1}:`, item);
                        
                        if (validateNeoItem(item)) {
                            // Map category names
                            let mappedCategory = item.category || item.neoCategory || 'others';
                            if (mappedCategory === 'other') mappedCategory = 'others'; // Fix category mapping
                            
                            const subscription = {
                                id: generateId(),
                                name: item.name.trim(),
                                amount: parseFloat(item.amount),
                                frequency: item.frequency || 'monthly',
                                category: 'subscription',
                                neoCategory: mappedCategory,
                                startDate: new Date().toISOString().slice(0, 10),
                                isActive: true
                            };
                            financialData.subscriptions.push(subscription);
                            imported++;
                            console.log(`✅ Imported: ${item.name}`);
                        } else {
                            skipped++;
                            console.log(`❌ Skipped: ${item.name || 'Unknown'} - validation failed`);
                        }
                    });
                    
                    console.log(`Import complete: ${imported} imported, ${skipped} skipped`);
                    
                    if (imported > 0) {
                        financialData.save();
                        renderSubscriptionsList();
                        updateDashboard();
                    }
                    
                    let message = `Successfully imported ${imported} Neo Credit Card expense${imported !== 1 ? 's' : ''}!`;
                    if (skipped > 0) {
                        message += `\n(${skipped} item${skipped !== 1 ? 's' : ''} skipped - check console for details)`;
                    }
                    
                    if (imported === 0 && skipped > 0) {
                        message = `No items imported. ${skipped} item${skipped !== 1 ? 's' : ''} failed validation. Check console for details.`;
                    }
                    
                    alert(message);
                    
                } catch (error) {
                    console.error('JSON Import Error:', error);
                    alert(`Error importing JSON: ${error.message}\n\nPlease check that your JSON contains an "expenses" array with valid expense objects.`);
                }
                
                // Clear the file input for next use
                event.target.value = '';
            };
            
            reader.onerror = function() {
                alert('Error reading file. Please try again.');
                event.target.value = '';
            };
            
            reader.readAsText(file);
        }

        function validateNeoItem(item) {
            console.log('Validating item:', item);
            
            // Check if item exists and has required properties
            if (!item || typeof item !== 'object') {
                console.log('Validation failed: item is not an object');
                return false;
            }
            
            // Validate name
            if (!item.name || typeof item.name !== 'string' || item.name.trim() === '') {
                console.log('Validation failed: invalid name -', item.name);
                return false;
            }
            
            // Validate amount
            const amount = parseFloat(item.amount);
            if (isNaN(amount) || amount <= 0) {
                console.log('Validation failed: invalid amount -', item.amount, 'parsed as:', amount);
                return false;
            }
            
            // Validate frequency (optional, defaults to monthly)
            const validFrequencies = ['weekly', 'biweekly', 'monthly', 'annual'];
            const frequency = item.frequency || 'monthly';
            if (!validFrequencies.includes(frequency.toLowerCase())) {
                console.log('Validation failed: invalid frequency -', item.frequency);
                return false;
            }
            
            // Validate category (optional, defaults to others)
            const validCategories = [...Object.keys(NEO_CATEGORIES), 'other']; // Include 'other' for mapping
            let category = item.category || item.neoCategory || 'others';
            if (category === 'other') category = 'others'; // Map 'other' to 'others'
            
            if (!Object.keys(NEO_CATEGORIES).includes(category)) {
                console.warn(`Invalid category '${item.category}' for item '${item.name}', will default to 'others'`);
                // Don't fail validation, just warn
            }
            
            console.log('✅ Validation passed for:', item.name);
            return true;
        }

        // Category Helper Functions
        function getCategoryInfo(categoryKey) {
            return NEO_CATEGORIES[categoryKey] || NEO_CATEGORIES.others;
        }

        function groupSubscriptionsByCategory(subscriptions) {
            const groups = {};
            
            // Initialize all categories
            Object.keys(NEO_CATEGORIES).forEach(key => {
                groups[key] = [];
            });
            
            // Group subscriptions by category
            subscriptions.forEach(sub => {
                const category = sub.neoCategory || 'others';
                if (groups[category]) {
                    groups[category].push(sub);
                } else {
                    groups.others.push(sub); // Fallback for invalid categories
                }
            });
            
            // Remove empty categories
            Object.keys(groups).forEach(key => {
                if (groups[key].length === 0) {
                    delete groups[key];
                }
            });
            
            return groups;
        }

        // Notes Management
        function saveNote(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            const noteContent = formData.get('noteContent').trim();
            if (!noteContent) return;
            
            const note = {
                id: 'note_' + Date.now(),
                content: noteContent,
                timestamp: new Date().toISOString(),
                createdAt: new Date().toLocaleString('en-US', {
                    year: 'numeric',
                    month: 'long', 
                    day: 'numeric',
                    hour: 'numeric',
                    minute: '2-digit',
                    hour12: true
                }),
                isActive: true
            };
            
            financialData.notes.unshift(note); // Add to beginning for newest first
            financialData.save();
            form.reset();
            renderNotesList();
        }

        function renderNotesList() {
            const container = $('notesList');
            const activeNotes = financialData.notes.filter(note => note.isActive);
            
            if (activeNotes.length === 0) {
                container.innerHTML = `
                    <div class="notes-empty-state">
                        <div class="notes-empty-icon">📝</div>
                        <div class="notes-empty-text">No notes yet</div>
                        <p>Add your first note above to get started</p>
                    </div>
                `;
                return;
            }
            
            // Sort by timestamp (newest first)
            const sortedNotes = activeNotes.sort((a, b) => 
                new Date(b.timestamp) - new Date(a.timestamp)
            );
            
            const notesHtml = sortedNotes.map(note => `
                <div class="note-item" data-note-id="${note.id}">
                    <div class="note-header">
                        <div class="note-timestamp">${note.createdAt}</div>
                        <div class="note-actions">
                            <button class="note-action-btn edit" onclick="editNote('${note.id}')" title="Edit">
                                <span>✏️</span>
                            </button>
                            <button class="note-action-btn delete" onclick="deleteNote('${note.id}')" title="Delete">
                                <span>🗑️</span>
                            </button>
                        </div>
                    </div>
                    <div class="note-content">${escapeHtml(note.content)}</div>
                </div>
            `).join('');
            
            container.innerHTML = notesHtml;
        }

        function editNote(id) {
            const note = financialData.notes.find(n => n.id === id);
            if (!note) return;
            
            const newContent = prompt('Edit note:', note.content);
            if (newContent !== null && newContent.trim() !== '') {
                note.content = newContent.trim();
                note.timestamp = new Date().toISOString(); // Update timestamp
                note.createdAt = new Date().toLocaleString('en-US', {
                    year: 'numeric', month: 'long', day: 'numeric',
                    hour: 'numeric', minute: '2-digit', hour12: true
                }) + ' (edited)';
                
                financialData.save();
                renderNotesList();
            }
        }

        function deleteNote(id) {
            if (!confirm('Are you sure you want to delete this note?')) return;
            
            const noteIndex = financialData.notes.findIndex(n => n.id === id);
            if (noteIndex !== -1) {
                financialData.notes[noteIndex].isActive = false; // Soft delete
                financialData.save();
                renderNotesList();
            }
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Analytics
        function updateAnalytics() {
            // Get last 6 months of data
            const months = [];
            const savingsData = [];
            const currentDate = new Date();
            
            for (let i = 5; i >= 0; i--) {
                const date = new Date(currentDate.getFullYear(), currentDate.getMonth() - i, 1);
                const monthKey = date.toISOString().slice(0, 7);
                const monthName = date.toLocaleDateString('en-US', { month: 'short' });
                
                months.push(monthName);
                
                // Calculate savings for this month
                const oldMonth = financialData.currentMonth;
                financialData.currentMonth = monthKey;
                const savings = financialData.getAvailableForSavings();
                savingsData.push(Math.max(0, savings));
                financialData.currentMonth = oldMonth;
            }
            
            // Draw savings trend chart
            drawLineChart('savingsTrendChart', months, savingsData, 'var(--primary-color)');
            
            // Calculate expense breakdown
            const expenseBreakdown = {
                'Budget Buddy': financialData.budgetBuddy
                    .filter(b => b.isActive)
                    .reduce((sum, b) => sum + financialData.calculateMonthlyAmount(b), 0),
                'Coast Capital Account': financialData.expenses
                    .filter(e => e.isActive)
                    .reduce((sum, e) => sum + financialData.calculateMonthlyAmount(e), 0),
                'Neo Credit Card': financialData.subscriptions
                    .filter(s => s.isActive)
                    .reduce((sum, s) => sum + financialData.calculateMonthlyAmount(s), 0),
                'Other Variables': financialData.monthlyVariables[financialData.currentMonth]?.otherExpenses || 0
            };
            
            const labels = Object.keys(expenseBreakdown);
            const data = Object.values(expenseBreakdown);
            const colors = ['#3b82f6', '#10b981', '#a855f7', '#f59e0b'];
            
            drawPieChart('expenseBreakdownChart', labels, data, colors);
            
            // Calculate YTD stats
            let ytdIncome = 0;
            let ytdExpenses = 0;
            let ytdMonths = 0;
            
            const currentYear = new Date().getFullYear();
            for (let month = 0; month <= currentDate.getMonth(); month++) {
                const monthKey = `${currentYear}-${String(month + 1).padStart(2, '0')}`;
                const oldMonth = financialData.currentMonth;
                financialData.currentMonth = monthKey;
                
                ytdIncome += financialData.getMonthlyIncome();
                ytdExpenses += financialData.getMonthlyExpenses();
                ytdMonths++;
                
                financialData.currentMonth = oldMonth;
            }
            
            const ytdSavings = ytdIncome - ytdExpenses;
            const savingsRate = ytdIncome > 0 ? (ytdSavings / ytdIncome) * 100 : 0;
            
            $('ytdIncome').textContent = formatCurrency(ytdIncome);
            $('ytdExpenses').textContent = formatCurrency(ytdExpenses);
            $('ytdSavings').textContent = formatCurrency(ytdSavings);
            $('ytdSavings').className = `quick-stat-value amount ${ytdSavings >= 0 ? 'positive' : 'negative'}`;
            $('ytdSavingsRate').textContent = `${savingsRate.toFixed(1)}%`;
        }

        // Settings
        function loadSettings() {
            $('savingsGoal').value = financialData.settings.savingsGoal;
        }

        function saveSettings() {
            financialData.settings.savingsGoal = parseFloat($('savingsGoal').value);
            financialData.save();
            updateDashboard();
            alert('Settings saved successfully!');
        }

        // Data Management
        function exportData() {
            const dataStr = JSON.stringify(financialData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `financial-data-${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            URL.revokeObjectURL(url);
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    Object.assign(financialData, data);
                    financialData.save();
                    location.reload();
                } catch (error) {
                    alert('Error importing data. Please check the file format.');
                }
            };
            reader.readAsText(file);
        }

        function confirmClearData() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                if (confirm('This will delete all your income, expenses, subscriptions, and monthly data. Are you absolutely sure?')) {
                    localStorage.removeItem('financialData');
                    location.reload();
                }
            }
        }

        // Utility Functions
        function toggleItem(type, id) {
            const array = financialData[type];
            const item = array.find(i => i.id === id);
            if (item) {
                item.isActive = !item.isActive;
                financialData.save();
                
                switch (type) {
                    case 'income':
                        renderIncomeList();
                        break;
                    case 'budgetBuddy':
                        renderBudgetBuddyList();
                        break;
                    case 'expenses':
                        renderExpensesList();
                        break;
                    case 'subscriptions':
                        renderSubscriptionsList();
                        break;
                }
                
                updateDashboard();
            }
        }

        function deleteItem(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            
            const array = financialData[type];
            const index = array.findIndex(i => i.id === id);
            if (index !== -1) {
                array.splice(index, 1);
                financialData.save();
                
                switch (type) {
                    case 'income':
                        renderIncomeList();
                        break;
                    case 'budgetBuddy':
                        renderBudgetBuddyList();
                        break;
                    case 'expenses':
                        renderExpensesList();
                        break;
                    case 'subscriptions':
                        renderSubscriptionsList();
                        break;
                }
                
                updateDashboard();
            }
        }

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            initNavigation();
            initMonthNavigation();
            updateDashboard();
            renderCalendar();
            
            // Theme toggle
            $('themeToggle').addEventListener('click', toggleTheme);
            
            // Close modals on background click
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal.id);
                    }
                });
            });
            
            // Set default dates for forms
            const today = new Date().toISOString().slice(0, 10);
            document.querySelectorAll('input[type="date"]').forEach(input => {
                input.value = today;
            });
        });

        // Auto-save reminder
        window.addEventListener('beforeunload', () => {
            financialData.save();
        });
    </script>
</body>
</html>